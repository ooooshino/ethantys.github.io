<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="OOOOSHINO,tangyusen9@gmail.com"><title>margin collapse & BFC · ooooshino的🛖</title><meta name="description" content="外边距重叠
外边距重叠（英文margin collapse，MDN 的解释如下：  块的顶部和底部边距有时合并(折叠)为单个边距，其大小是单个边距(或者是单个边距中最大的一个，如果它们相等的话)，这种行为称为边距折叠。注意，浮动和绝对定位元素的边距永远不会崩溃。

这种情况并不是浏览器的bug，而是"><meta name="keywords" content="oshino,两仪猿,ooooshino,EthanTYS"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.svg" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/icons/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;500;700&amp;display=swap"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar"><div class="logo-title"><div class="title"><img src="/images/oshino.svg" style="width:267px;"><h3 title="">我们在以自己的方式努力着去成为自己想成为的人，这段时间，我们一直在成长，大脑不能记下每时每刻，但这里可以</h3><p class="description">🔗 近期目标：<span>备考CET-6</span></p></div><ul class="social-links">🔗 社交链接：<li><a target="_blank" rel="noopener" href="https://twitter.com/tangyuse"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="http://instagram.com/tangsenyu0915"><i class="fa fa-instagram"></i></a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a target="_blank" rel="noopener" href="http://weibo.com/ooooshino"><i class="fa fa-weibo"></i></a></li><li><a target="_blank" rel="noopener" href="http://github.com/ooooshino"><i class="fa fa-github"></i></a></li></ul></div><div class="banner"> <img src="/images/banner.jpg" style="width:300px;"></div><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://github.com/EthanTYS/ethantys.github.io">ooooshino</a><div class="run"><span>It's been running for 20 days</span></div><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top"><div class="nav"><li><a href="/">Home</a></li><li><a target="_blank" rel="noopener" href="https://cnotion.notion.site/OOOOSHINO-772d5e9b160b48d69ffbd5e40f70b11f">About</a></li><li><a href="/archives">Archive</a></li><li><a href="/atom.xml">RSS</a></li></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post"><div class="post-title"><h3><a>margin collapse &amp; BFC</a></h3></div><div class="post-content"><h2 id="外边距重叠"><a href="#外边距重叠" class="headerlink" title="外边距重叠"></a>外边距重叠</h2><ul>
<li>外边距重叠（英文margin collapse，MDN 的解释如下：  块的顶部和底部边距有时合并(折叠)为单个边距，其大小是单个边距(或者是单个边距中最大的一个，如果它们相等的话)，这种行为称为边距折叠。注意，浮动和绝对定位元素的边距永远不会崩溃。</li>
</ul>
<p>这种情况并不是浏览器的bug，而是为某些情景而设计的，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;design&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam harum</span><br><span class="line">        voluptas ullam, quia veniam sunt in maiores optio laboriosam, earum</span><br><span class="line">        minus veritatis deserunt delectus repellendus eaque nostrum vitae! Amet,</span><br><span class="line">        alias.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum, dolor sit amet consectetur adipisicing elit. Necessitatibus</span><br><span class="line">        ipsam asperiores beatae facere adipisci quos nulla, officiis, fugiat</span><br><span class="line">        perspiciatis delectus temporibus aperiam a iste. Odit corporis</span><br><span class="line">        recusandae fugiat quasi tempore?</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Temporibus ut</span><br><span class="line">        magni commodi accusamus eligendi amet dolorum vel, culpa facilis non.</span><br><span class="line">        Doloribus labore nemo deserunt explicabo quasi distinctio minus quo eum!</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Nulla, libero</span><br><span class="line">        nisi dicta culpa perferendis et quasi, error, ullam magni ratione</span><br><span class="line">        praesentium. Iste esse ducimus voluptatum quae? Animi doloribus omnis</span><br><span class="line">        voluptas.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d5124d8c-3dc2-4e80-bbbc-f28d0a94cd52/Untitled.png" alt="Untitled"></p>
<p>为了让段落分明，一般会给上margin</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p&#123;</span><br><span class="line">		text-indent: 2em;  /* 顺便让其首行文本的缩进2个em看着舒服些 */</span><br><span class="line">    margin: 1.7em 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/742650f4-3cdb-4df1-a2d7-5668c1085509/Untitled.png" alt="Untitled"></p>
<p>当你打开控制台查看p标签的时候，会发现他们间隔是一样的，也就是为了这种情况而设计的，不过也产生了一种生产环境经常遇到的“bug”，叫margin collapse，也就是外边距重叠了</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/36352ede-5ef5-484a-9699-f49301c1ebcc/ezgif-4-cb26987608ab.gif" alt="ezgif-4-cb26987608ab.gif"></p>
<h3 id="外边距重叠的三种情况"><a href="#外边距重叠的三种情况" class="headerlink" title="外边距重叠的三种情况"></a>外边距重叠的三种情况</h3><ol>
<li>相邻的两个块级盒子，在第一个盒子设置了margin-bottom后第二个盒子设置了margin-top</li>
<li>三个层级的块盒子，最后一个层级的盒子相对于第二个层级盒子设置margin-top</li>
<li>三个同级对块盒子，中间对盒子内容为空，想设置margin-top和margin-bottom级来为上下两个盒子制造空隙，将发生外边距崩塌</li>
</ol>
<aside>
💡 注意，会造成外边距重叠的情况，只有**垂直方向上的块级**盒子

</aside>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9c3b13c6-7d16-45c6-8e9a-3c53d1f04126/Untitled.png" alt="Untitled"></p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li>子绝父相</li>
<li>inline-block不会造成外边距崩塌，所以可以改成inline-block(改成inline-block后要记得设置宽高)</li>
<li>设置pisition为relative，然后用top来代替margin-top </li>
<li>设置float后再来margin-top</li>
<li>不能设置外边距，那就改成内边距</li>
<li>添加边框，设置边框厚度</li>
<li>创建BFC（overflow:hidden会触发创建BFC）</li>
</ol>
<h2 id="BFC（block-formating-context-块级格式化上下文）"><a href="#BFC（block-formating-context-块级格式化上下文）" class="headerlink" title="BFC（block formating context 块级格式化上下文）"></a>BFC（block formating context 块级格式化上下文）</h2><p>前端的布局有三种：</p>
<ol>
<li>普通流（也是浏览器默认的）<ul>
<li>块级格式化上下文（BFC，block formatting context）。</li>
<li>内联格式化上下文（IFC，inline formatting context）。</li>
<li>弹性格式化上下文（FFC，flex formatting context），在 CSS3 中定义。</li>
<li>栅格格式化上下文（GFC，grid formatting context），在 CSS3 中定义。</li>
</ul>
</li>
<li>flow布局</li>
<li>绝对定位</li>
</ol>
<p>后两个都会脱离文档流，接下来要讲的BFC，就是属于普通流一种</p>
<p><strong>BFC会形成独立的渲染区域，使得内部元素的渲染不会影响到外界</strong></p>
<ol>
<li>清除浮动 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//主要代码，为了方便看到效果，给了背景色</span><br><span class="line">// rgb(228, 99, 48)</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_box&quot;</span>&gt;</span>   </span><br><span class="line">	  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./img/selfie.jpg&quot;</span>/&gt;</span></span><br><span class="line">		 // rgb(168, 218, 235)</span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;statement&quot;</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">p</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">p</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5265f499-5d87-48f8-8e24-fa5d8a92eb17/Untitled.png" alt="Untitled"> 一般在情况下，都是一边产品图，一边文字说明，这里我们让图片设置为 flow（当然还有其他解决方案，这里是为了方便举例子，其他就不扩展了） <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5cdb26bc-b6a4-447d-a958-8f8277f89b3e/Untitled.png" alt="Untitled"> 可以看到flow设置为flow之后，img脱离了文档流，content_box的大小变成只靠两个p来支撑，我们需要的是content_box是img的大小也<strong>影响着</strong>content_box，这种情况下就可以给content_box的css添加<strong>一个属性来触发BFC，因为为了在此情况下不要有太大改变，一般我们使用display:flow-root或者contain:layout（加黑是因为你也可以使用其他属性来触发BFC，比如overflow:hidden)</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content_box</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: flow-root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d165bb2-05c8-41a4-8f34-dd9afafdc45e/Untitled.png" alt="Untitled"> <strong>这样就可以清除掉img的 flow:left  所脱离文档流从而影响content_box的整体渲染</strong></li>
<li><strong>包裹浮动</strong> 还是上面👆的例子，打开控制台，元素里查看以下statement盒子 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/65c2edb5-09c6-4a75-99b9-20f01c236242/Untitled.png" alt="Untitled"> 看到这里的p标签还是占着一整行，这样在我们后面调整statement盒子使得文字不要那么贴近图片的时候是很不方便的，比如添加padding-left（ps：调整p的padding/margin也一样） <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8e833e90-0dac-4320-94ca-2f725b5e36e8/Untitled.png" alt="Untitled"> <strong>我们也可以给statement添加一个BFC，让statement成为一个独立渲染的区域不影响外部</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.statement</span>&#123;</span><br><span class="line">	<span class="attribute">padding-left</span>: <span class="number">2em</span>;</span><br><span class="line">	<span class="attribute">display</span>: flow-root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 再刷新一下 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/80da0761-de79-4316-bb00-986e8bb094ed/Untitled.png" alt="Untitled"> 这样就可以使元素（statement）包裹着浮动元素了</li>
<li><strong>解决margin collapse</strong> 还是上面的例子，p标签太近了，我们添加个属性margin <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">1.7em</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa024b86-4b5f-4d6d-944e-c1add2435284/ezgif-2-50fe72f50912.gif" alt="ezgif-2-50fe72f50912.gif"> 可以看到这里发生了一开始我们提到的外边距重叠（margin collapse），我也提到了这是专门这样子设计的，不是bug，怎么解决呢，没错，上面解决方案的第七个，可以创建一个BFC <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;statement&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam</span><br><span class="line">        harum voluptas ullam, quia veniam sunt in maiores optio</span><br><span class="line">        laboriosam, earum minus veritatis deserunt delectus repellendus</span><br><span class="line">        eaque nostrum vitae! Amet, alias.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam</span><br><span class="line">        harum voluptas ullam, quia veniam sunt in maiores optio</span><br><span class="line">        laboriosam, earum minus veritatis deserunt delectus repellendus</span><br><span class="line">        eaque nostrum vitae! Amet, alias.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.statement</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: flow-root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 给p套一个div，让这个div形成一个BFC独立渲染 <img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ef44d4f2-7da1-414e-a079-5ee71048778c/Untitled.png" alt="Untitled"> 这样就可以防止外边距重叠了</li>
</ol>
<p>创建BFC有以下（用得比较多得加黑了</p>
<ol>
<li><html/> 跟元素</li>
<li><strong>设置了float属性且值不为none的元素</strong></li>
<li>绝对定位的元素（position:absolute)</li>
<li><strong>设置了display:inline-block/ flow-root的元素</strong></li>
<li>设置了display:table-<em>的元素（例如table-cell、table-caption、table-row*<em>等）</em></em></li>
<li><strong>设置了overflow值不为visible和clip以外的元素（例如：overflow:hidden)</strong></li>
<li>设置contain的元素（layout | content | paint)</li>
<li>flex 和grid布局的子元素（非flex和grid布局容器本身）</li>
<li>多列布局，设置了column-count的元素，或设置了column-span:all的元素</li>
</ol>
<p><strong>提示</strong>：<code>display: flow-root</code>，<code>contain: layout</code> 等是无副作用的，可在不影响已有布局的情况下触发 BFC，所以会用的比较多</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2021-10-18</span><i class="fa fa-comment-o"></i><a href="/2021/10/18/margin%20collapse%20&amp;%20BFC/#comments">Comments</a><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://oshino.cc/2021/10/18/margin collapse &amp; BFC/,ooooshino的🛖,margin collapse &amp; BFC,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2021/10/16/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" title="nginx反向代理和负载均衡">Next Post</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'ooooshino';
var disqus_identifier = '2021/10/18/margin collapse &amp; BFC/';
var disqus_title = 'margin collapse &amp; BFC';
var disqus_url = 'https://oshino.cc/2021/10/18/margin collapse &amp; BFC/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>